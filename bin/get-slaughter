#!/bin/sh
#
#  Install the slaughter client:
#
#  wget -O - https://raw.github.com/skx/dotfiles/master/bin/get-slaughter | sh
#
#  Probably me-specific.
#
# Steve
# --
#


#
#  See if we have the apt-signature helper.
#
if [ -x /usr/bin/apt-key ]; then

    #
    #  If we're missing the key ..
    #
    if ( /usr/bin/apt-key list | grep 2048g/0CB6CBA8 >/dev/null 2>/dev/null ) ; then

        #
        #  Download and install
        #
        if ( which wget >/dev/null 2>/dev/null ) ; then

            #
            #  Get the key and pipe to add.
            #
            wget http://packages.steve.org.uk/slaughter/apt-key.pub -O-  | /usr/bin/apt-key add -

            #
            #  Now clean the downloaded-lists and refetch
            #
            apt-get clean

        else
            #
            #  Error
            #
            echo "wget not installed - failed to install apt-signing key".
            exit 1
        fi
    fi
fi

#
#  Install apt
#
if [ ! -e /etc/apt/sources.list.d/slaughter.list ]; then
    cat > /etc/apt/sources.list.d/slaughter.list <<EOF
#
# Slaughter packages for squeeze
#
deb-src http://packages.steve.org.uk/slaughter/squeeze/ ./
deb     http://packages.steve.org.uk/slaughter/squeeze/ ./

EOF
fi



#
#  Make the configuration directory.
#
mkdir -p /etc/slaughter || true



#
#  If we don't have a conf file, create it.
#
if [ ! -e  /etc/slaughter/slaughter.conf ]; then
    cat > /etc/slaughter/slaughter.conf <<EOF
prefix    = rsync://www.steve.org.uk/slaughter
transport = rsync
EOF
fi



#
#  Update the system.
#
apt-get update



#
#  Install the package
#
apt-get install --yes --force-yes slaughter2-client

